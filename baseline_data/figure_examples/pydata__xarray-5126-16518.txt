Instance ID: pydata__xarray-5126-16518

Baseline 1 (Pynguin):
Predicted Test Suite: # Test cases automatically generated by Pynguin (https://www.pynguin.eu).
# Please check them before you use them.
import pytest
import xarray.core.formatting_html as module_0
import _locale as module_1
import email.message as module_2
import pkg_resources._vendor.more_itertools.more as module_3


def test_case_0():
    none_type_0 = None
    var_0 = module_0.format_dims(none_type_0, none_type_0)
    assert var_0 == ""
    assert module_0.STATIC_FILES == (
        "static/html/icons-svg-inline.html",
        "static/css/style.css",
    )


@pytest.mark.xfail(strict=True)
def test_case_1():
    var_0 = module_1.localeconv()
    var_1 = module_0.summarize_attrs(var_0)
    assert (
        var_1
        == "<dl class='xr-attrs'><dt><span>int_curr_symbol :</span></dt><dd>USD </dd><dt><span>currency_symbol :</span></dt><dd>$</dd><dt><span>mon_decimal_point :</span></dt><dd>.</dd><dt><span>mon_thousands_sep :</span></dt><dd>,</dd><dt><span>mon_grouping :</span></dt><dd>[3, 3, 0]</dd><dt><span>positive_sign :</span></dt><dd></dd><dt><span>negative_sign :</span></dt><dd>-</dd><dt><span>int_frac_digits :</span></dt><dd>2</dd><dt><span>frac_digits :</span></dt><dd>2</dd><dt><span>p_cs_precedes :</span></dt><dd>1</dd><dt><span>p_sep_by_space :</span></dt><dd>0</dd><dt><span>n_cs_precedes :</span></dt><dd>1</dd><dt><span>n_sep_by_space :</span></dt><dd>0</dd><dt><span>p_sign_posn :</span></dt><dd>1</dd><dt><span>n_sign_posn :</span></dt><dd>1</dd><dt><span>decimal_point :</span></dt><dd>.</dd><dt><span>thousands_sep :</span></dt><dd>,</dd><dt><span>grouping :</span></dt><dd>[3, 3, 0]</dd></dl>"
    )
    assert module_0.STATIC_FILES == (
        "static/html/icons-svg-inline.html",
        "static/css/style.css",
    )
    var_1.__getstate__()


@pytest.mark.xfail(strict=True)
def test_case_2():
    var_0 = module_1.localeconv()
    module_0.summarize_variable(var_0, var_0, var_0, preview=var_0)


@pytest.mark.xfail(strict=True)
def test_case_3():
    none_type_0 = None
    module_0.summarize_variable(none_type_0, none_type_0, none_type_0, none_type_0)


def test_case_4():
    none_type_0 = None
    var_0 = module_0.collapsible_section(none_type_0, details=none_type_0)
    assert module_0.STATIC_FILES == (
        "static/html/icons-svg-inline.html",
        "static/css/style.css",
    )


def test_case_5():
    none_type_0 = None
    var_0 = module_0.collapsible_section(none_type_0, none_type_0, enabled=none_type_0)
    assert module_0.STATIC_FILES == (
        "static/html/icons-svg-inline.html",
        "static/css/style.css",
    )


@pytest.mark.xfail(strict=True)
def test_case_6():
    none_type_0 = None
    module_0.array_section(none_type_0)


@pytest.mark.xfail(strict=True)
def test_case_7():
    none_type_0 = None
    module_0.short_data_repr_html(none_type_0)


@pytest.mark.xfail(strict=True)
def test_case_8():
    none_type_0 = None
    module_0.summarize_attrs(none_type_0)


@pytest.mark.xfail(strict=True)
def test_case_9():
    none_type_0 = None
    module_0.summarize_vars(none_type_0)


@pytest.mark.xfail(strict=True)
def test_case_10():
    none_type_0 = None
    module_0.dataset_repr(none_type_0)


def test_case_11():
    var_0 = module_1.localeconv()
    var_1 = module_0.format_dims(var_0, var_0)
    assert (
        var_1
        == "<ul class='xr-dim-list'><li><span class='xr-has-index'>int_curr_symbol</span>: USD </li><li><span class='xr-has-index'>currency_symbol</span>: $</li><li><span class='xr-has-index'>mon_decimal_point</span>: .</li><li><span class='xr-has-index'>mon_thousands_sep</span>: ,</li><li><span class='xr-has-index'>mon_grouping</span>: [3, 3, 0]</li><li><span class='xr-has-index'>positive_sign</span>: </li><li><span class='xr-has-index'>negative_sign</span>: -</li><li><span class='xr-has-index'>int_frac_digits</span>: 2</li><li><span class='xr-has-index'>frac_digits</span>: 2</li><li><span class='xr-has-index'>p_cs_precedes</span>: 1</li><li><span class='xr-has-index'>p_sep_by_space</span>: 0</li><li><span class='xr-has-index'>n_cs_precedes</span>: 1</li><li><span class='xr-has-index'>n_sep_by_space</span>: 0</li><li><span class='xr-has-index'>p_sign_posn</span>: 1</li><li><span class='xr-has-index'>n_sign_posn</span>: 1</li><li><span class='xr-has-index'>decimal_point</span>: .</li><li><span class='xr-has-index'>thousands_sep</span>: ,</li><li><span class='xr-has-index'>grouping</span>: [3, 3, 0]</li></ul>"
    )
    assert module_0.STATIC_FILES == (
        "static/html/icons-svg-inline.html",
        "static/css/style.css",
    )


@pytest.mark.xfail(strict=True)
def test_case_12():
    var_0 = module_1.localeconv()
    module_0.summarize_vars(var_0)


def test_case_13():
    var_0 = module_1.localeconv()
    var_1 = module_0.collapsible_section(var_0, var_0, var_0, var_0)
    assert module_0.STATIC_FILES == (
        "static/html/icons-svg-inline.html",
        "static/css/style.css",
    )


def test_case_14():
    var_0 = module_1.localeconv()
    var_1 = var_0.clear()
    var_2 = module_0.summarize_coords(var_0)
    assert var_2 == "<ul class='xr-var-list'></ul>"
    assert module_0.STATIC_FILES == (
        "static/html/icons-svg-inline.html",
        "static/css/style.css",
    )
    var_3 = module_0.collapsible_section(var_1, var_2, enabled=var_2, collapsed=var_2)


@pytest.mark.xfail(strict=True)
def test_case_15():
    var_0 = module_1.localeconv()
    module_0.summarize_coords(var_0)


@pytest.mark.xfail(strict=True)
def test_case_16():
    message_0 = module_2.Message()
    var_0 = module_0.summarize_coords(message_0)
    assert var_0 == "<ul class='xr-var-list'></ul>"
    assert module_0.STATIC_FILES == (
        "static/html/icons-svg-inline.html",
        "static/css/style.css",
    )
    module_0.summarize_vars(var_0)


@pytest.mark.xfail(strict=True)
def test_case_17():
    var_0 = module_1.localeconv()
    var_1 = module_3.longest_common_prefix(var_0)
    var_2 = module_0.format_dims(var_0, var_1)
    assert (
        var_2
        == "<ul class='xr-dim-list'><li><span>int_curr_symbol</span>: USD </li><li><span>currency_symbol</span>: $</li><li><span>mon_decimal_point</span>: .</li><li><span>mon_thousands_sep</span>: ,</li><li><span>mon_grouping</span>: [3, 3, 0]</li><li><span>positive_sign</span>: </li><li><span>negative_sign</span>: -</li><li><span>int_frac_digits</span>: 2</li><li><span>frac_digits</span>: 2</li><li><span>p_cs_precedes</span>: 1</li><li><span>p_sep_by_space</span>: 0</li><li><span>n_cs_precedes</span>: 1</li><li><span>n_sep_by_space</span>: 0</li><li><span>p_sign_posn</span>: 1</li><li><span>n_sign_posn</span>: 1</li><li><span>decimal_point</span>: .</li><li><span>thousands_sep</span>: ,</li><li><span>grouping</span>: [3, 3, 0]</li></ul>"
    )
    assert module_0.STATIC_FILES == (
        "static/html/icons-svg-inline.html",
        "static/css/style.css",
    )
    var_1.get_filename()


def test_case_18():
    message_0 = module_2.Message()
    var_0 = module_0.summarize_vars(message_0)
    assert var_0 == "<ul class='xr-var-list'></ul>"
    assert module_0.STATIC_FILES == (
        "static/html/icons-svg-inline.html",
        "static/css/style.css",
    )

Coverage: -1
Mutation Score: -1

Baseline 2 (CodaMosa):
Predicted Test Suite: import xarray.core.formatting_html as module_0

def test_case_1():
    pass


def test_case_2():
    var_0 = {}
    var_1 = []
    var_2 = module_0.format_dims(var_0, var_1)
    assert var_2 == ''
    assert module_0.STATIC_FILES == ('static/html/icons-svg-inline.html', 'static/css/style.css')
    str_0 = 'time'
    int_0 = 10
    int_1 = {str_0: int_0}
    var_3 = []
    var_4 = module_0.format_dims(int_1, var_3)
    assert var_4 == "<ul class='xr-dim-list'><li><span>time</span>: 10</li></ul>"


def test_case_3():
    dict_0 = {}
    var_0 = module_0.summarize_coords(dict_0)
    assert var_0 == "<ul class='xr-var-list'></ul>"
    assert module_0.STATIC_FILES == ('static/html/icons-svg-inline.html', 'static/css/style.css')


def test_case_4():
    bytes_0 = None
    var_0 = module_0.collapsible_section(bytes_0)
    assert module_0.STATIC_FILES == ('static/html/icons-svg-inline.html', 'static/css/style.css')


def test_case_5():
    dict_0 = {}
    var_0 = module_0.summarize_coords(dict_0)
    assert var_0 == "<ul class='xr-var-list'></ul>"
    assert module_0.STATIC_FILES == ('static/html/icons-svg-inline.html', 'static/css/style.css')
    var_1 = module_0.summarize_vars(dict_0)
    assert var_1 == "<ul class='xr-var-list'></ul>"


def test_case_6():
    str_0 = '_"!h 9~A e=6an 4'
    float_0 = -1169.0
    str_1 = '*:acV0$'
    str_2 = '(Pz<7N\x0c7(B.E"b'
    float_1 = -1504.65
    dict_0 = {str_0: str_1, float_0: str_2, float_1: str_2}
    var_0 = module_0.collapsible_section(str_0, float_0, str_1, str_2, float_1, dict_0)
    assert module_0.STATIC_FILES == ('static/html/icons-svg-inline.html', 'static/css/style.css')


def test_case_7():
    var_0 = {}
    var_1 = module_0.format_dims(var_0, var_0)
    assert var_1 == ''
    assert module_0.STATIC_FILES == ('static/html/icons-svg-inline.html', 'static/css/style.css')
    str_0 = 'time'
    int_0 = 10
    int_1 = {str_0: int_0}
    str_1 = [str_0]
    var_2 = module_0.format_dims(int_1, str_1)
    assert var_2 == "<ul class='xr-dim-list'><li><span class='xr-has-index'>time</span>: 10</li></ul>"# Automatically generated by Pynguin.


def test_case_8():
    try:
        float_0 = 1588.143826
        var_0 = module_0.short_data_repr_html(float_0)
    except BaseException:
        pass


def test_case_9():
    try:
        dict_0 = {}
        str_0 = 'TCgDr^XEIGl~5Y^`s;iz'
        var_0 = module_0.format_dims(dict_0, str_0)
        assert var_0 == ''
        assert module_0.STATIC_FILES == ('static/html/icons-svg-inline.html', 'static/css/style.css')
        bytes_0 = b'\xc5\xa3d\xa3ps'
        var_1 = module_0.dataset_repr(bytes_0)
    except BaseException:
        pass


def test_case_10():
    try:
        list_0 = None
        var_0 = module_0.summarize_attrs(list_0)
    except BaseException:
        pass


def test_case_11():
    try:
        bool_0 = False
        set_0 = {bool_0, bool_0, bool_0, bool_0}
        var_0 = module_0.summarize_coord(bool_0, set_0)
    except BaseException:
        pass


def test_case_12():
    try:
        dict_0 = None
        var_0 = module_0.summarize_variable(dict_0, dict_0)
    except BaseException:
        pass


def test_case_13():
    try:
        bytes_0 = None
        dict_0 = {bytes_0: bytes_0, bytes_0: bytes_0, bytes_0: bytes_0}
        var_0 = module_0.summarize_vars(dict_0)
    except BaseException:
        pass


def test_case_14():
    try:
        bytes_0 = b'U\x19U.\x90m'
        var_0 = module_0.dim_section(bytes_0)
    except BaseException:
        pass


def test_case_15():
    try:
        str_0 = '#'
        var_0 = module_0.array_section(str_0)
    except BaseException:
        pass


def test_case_16():
    try:
        str_0 = 'aNdN#gm2AZ|:T,^z'
        var_0 = module_0.array_repr(str_0)
    except BaseException:
        pass


def test_case_17():
    try:
        set_0 = set()
        var_0 = module_0.dataset_repr(set_0)
    except BaseException:
        pass


def test_case_18():
    try:
        str_0 = 'Tt3\nWXM4j)eL\\@RB}'
        set_0 = None
        var_0 = module_0.summarize_variable(str_0, set_0, str_0)
    except BaseException:
        pass


def test_case_19():
    try:
        str_0 = 'H<?cCgZ\r97HhR|'
        dict_0 = {str_0: str_0, str_0: str_0, str_0: str_0}
        var_0 = module_0.summarize_attrs(dict_0)
        assert var_0 == "<dl class='xr-attrs'><dt><span>H&lt;?cCgZ\r97HhR| :</span></dt><dd>H&lt;?cCgZ\r97HhR|</dd></dl>"
        assert module_0.STATIC_FILES == ('static/html/icons-svg-inline.html', 'static/css/style.css')
        tuple_0 = None
        var_1 = module_0.summarize_coord(str_0, tuple_0)
    except BaseException:
        pass


def test_case_20():
    try:
        float_0 = -222.83511917269254
        str_0 = 'H <\r#g]|$GA\x0c<{A~H:>'
        var_0 = module_0.collapsible_section(str_0)
        assert module_0.STATIC_FILES == ('static/html/icons-svg-inline.html', 'static/css/style.css')
        set_0 = {float_0, float_0}
        list_0 = [var_0, set_0]
        tuple_0 = (list_0, set_0, set_0)
        var_1 = module_0.collapsible_section(set_0, str_0, float_0, tuple_0)
        dict_0 = {}
        var_2 = module_0.summarize_coords(dict_0)
        assert var_2 == "<ul class='xr-var-list'></ul>"
        var_3 = module_0.array_section(float_0)
    except BaseException:
        pass


def test_case_21():
    try:
        int_0 = 1626
        dict_0 = {int_0: int_0}
        var_0 = module_0.summarize_coords(dict_0)
    except BaseException:
        pass


def test_case_22():
    try:
        str_0 = 'H <#g]|$G<{A~H:>'
        var_0 = module_0.collapsible_section(str_0)
        assert module_0.STATIC_FILES == ('static/html/icons-svg-inline.html', 'static/css/style.css')
        float_0 = None
        int_0 = 35
        float_1 = -4634.0874
        list_0 = [float_1, float_0, float_1, float_1]
        bool_0 = False
        var_1 = module_0.collapsible_section(str_0, int_0, float_1, list_0, bool_0)
        dict_0 = {}
        var_2 = module_0.summarize_coords(dict_0)
        assert var_2 == "<ul class='xr-var-list'></ul>"
        var_3 = module_0.array_section(float_1)
    except BaseException:
        pass

Coverage: 55.65217391304348
Mutation Score: 14.14

Baseline 3 (GPT-4o):
Predicted Test Suite: 
import unittest
from unittest.mock import MagicMock, patch
from xarray.core import formatting_html as fh
from collections import OrderedDict

class TestFormattingHTML(unittest.TestCase):

    def setUp(self):
        self.mock_array = MagicMock()
        self.mock_array.dims = ('x', 'y')
        self.mock_array.shape = (10, 20)
        self.mock_array.name = 'test_array'
        self.mock_array.coords = {'x': MagicMock(), 'y': MagicMock()}
        self.mock_array.attrs = {'attr1': 'value1', 'attr2': 'value2'}
        self.mock_array.variable = MagicMock()
        self.mock_array.variable._data = MagicMock()

        self.mock_dataset = MagicMock()
        self.mock_dataset.dims = {'x': 10, 'y': 20}
        self.mock_dataset.coords = {'x': MagicMock(), 'y': MagicMock()}
        self.mock_dataset.data_vars = {'var1': MagicMock(), 'var2': MagicMock()}
        self.mock_dataset.attrs = {'attr1': 'value1', 'attr2': 'value2'}

    @patch('xarray.core.formatting_html.pkg_resources.resource_string')
    def test_load_static_files(self, mock_resource_string):
        mock_resource_string.return_value = b"<svg></svg>"
        result = fh._load_static_files()
        self.assertEqual(len(result), 2)
        self.assertTrue(all(isinstance(r, str) for r in result))

    def test_short_data_repr_html(self):
        self.mock_array.variable._data._repr_html_ = MagicMock(return_value="<div>HTML</div>")
        result = fh.short_data_repr_html(self.mock_array)
        self.assertEqual(result, "<div>HTML</div>")

        del self.mock_array.variable._data._repr_html_
        with patch('xarray.core.formatting_html.short_data_repr', return_value='short_repr'):
            result = fh.short_data_repr_html(self.mock_array)
            self.assertEqual(result, "<pre>short_repr</pre>")

    def test_format_dims(self):
        dims = OrderedDict([('x', 10), ('y', 20)])
        coord_names = ['x']
        result = fh.format_dims(dims, coord_names)
        self.assertIn("class='xr-has-index'", result)
        self.assertIn("<li><span class='xr-has-index'>x</span>: 10</li>", result)

    def test_summarize_attrs(self):
        attrs = {'attr1': 'value1', 'attr2': 'value2'}
        result = fh.summarize_attrs(attrs)
        self.assertIn("<dt><span>attr1 :</span></dt><dd>value1</dd>", result)

    def test_icon(self):
        result = fh._icon("test-icon")
        self.assertIn("<svg class='icon xr-test-icon'>", result)

    def test_summarize_coord_multiindex(self):
        coord = MagicMock()
        coord.level_names = ['level1', 'level2']
        with patch('xarray.core.formatting_html.summarize_variable', return_value='summary'):
            result = fh._summarize_coord_multiindex('coord_name', coord)
            self.assertIn('summary', result)

    def test_summarize_coord(self):
        var = MagicMock()
        var.dims = ['x']
        var.variable.to_index_variable.return_value.level_names = ['level1']
        with patch('xarray.core.formatting_html.summarize_variable', return_value='summary'):
            result = fh.summarize_coord('x', var)
            self.assertIn('summary', result)

    def test_summarize_coords(self):
        variables = {'x': self.mock_array, 'y': self.mock_array}
        with patch('xarray.core.formatting_html.summarize_coord', return_value={'x': 'summary'}):
            result = fh.summarize_coords(variables)
            self.assertIn("<li class='xr-var-item'>summary</li>", result)

    def test_summarize_variable(self):
        var = MagicMock()
        var.dims = ['x']
        var.dtype = 'float64'
        var.attrs = {'attr1': 'value1'}
        with patch('xarray.core.formatting_html.inline_variable_array_repr', return_value='preview'):
            with patch('xarray.core.formatting_html.short_data_repr_html', return_value='data_repr'):
                result = fh.summarize_variable('var_name', var)
                self.assertIn("<div class='xr-var-name'><span>var_name</span></div>", result)

    def test_summarize_vars(self):
        variables = {'var1': self.mock_array, 'var2': self.mock_array}
        with patch('xarray.core.formatting_html.summarize_variable', return_value='summary'):
            result = fh.summarize_vars(variables)
            self.assertIn("<li class='xr-var-item'>summary</li>", result)

    def test_collapsible_section(self):
        result = fh.collapsible_section('Section', n_items=5)
        self.assertIn("Section:<span>(5)</span>", result)

    def test_mapping_section(self):
        mapping = {'key1': 'value1', 'key2': 'value2'}
        with patch('xarray.core.formatting_html._get_boolean_with_default', return_value=True):
            with patch('xarray.core.formatting_html.summarize_attrs', return_value='details'):
                result = fh._mapping_section(mapping, 'Test', fh.summarize_attrs, 10, 'option_name')
                self.assertIn("Test:<span>(2)</span>", result)

    def test_dim_section(self):
        result = fh.dim_section(self.mock_dataset)
        self.assertIn("Dimensions", result)

    def test_array_section(self):
        with patch('xarray.core.formatting_html.inline_variable_array_repr', return_value='preview'):
            with patch('xarray.core.formatting_html.short_data_repr_html', return_value='data_repr'):
                result = fh.array_section(self.mock_array)
                self.assertIn("Show/hide data repr", result)

    def test_array_repr(self):
        with patch('xarray.core.formatting_html._obj_repr', return_value='obj_repr'):
            result = fh.array_repr(self.mock_array)
            self.assertEqual(result, 'obj_repr')

    def test_dataset_repr(self):
        with patch('xarray.core.formatting_html._obj_repr', return_value='obj_repr'):
            result = fh.dataset_repr(self.mock_dataset)
            self.assertEqual(result, 'obj_repr')


Coverage: 70.43478260869566
Mutation Score: 51.52

Approach:
Predicted Test Suite: import unittest
from unittest.mock import MagicMock, patch
from xarray.core import formatting_html as fh
from collections import OrderedDict

class TestFormattingHTML(unittest.TestCase):

    def setUp(self):
        self.mock_array = MagicMock()
        self.mock_array.dims = ('x', 'y')
        self.mock_array.shape = (10, 20)
        self.mock_array.name = 'test_array'
        self.mock_array.coords = {'x': MagicMock(), 'y': MagicMock()}
        self.mock_array.attrs = {'attr1': 'value1', 'attr2': 'value2'}
        self.mock_array.variable = MagicMock()
        self.mock_array.variable._data = MagicMock()

        self.mock_dataset = MagicMock()
        self.mock_dataset.dims = {'x': 10, 'y': 20}
        self.mock_dataset.coords = {'x': MagicMock(), 'y': MagicMock()}
        self.mock_dataset.data_vars = {'var1': MagicMock(), 'var2': MagicMock()}
        self.mock_dataset.attrs = {'attr1': 'value1', 'attr2': 'value2'}

    @patch('xarray.core.formatting_html.pkg_resources.resource_string')
    def test_load_static_files(self, mock_resource_string):
        mock_resource_string.return_value = b"<svg></svg>"
        result = fh._load_static_files()
        self.assertEqual(len(result), 2)
        self.assertTrue(all(isinstance(r, str) for r in result))

    def test_short_data_repr_html(self):
        self.mock_array.variable._data._repr_html_ = MagicMock(return_value="<div>HTML</div>")
        result = fh.short_data_repr_html(self.mock_array)
        self.assertEqual(result, "<div>HTML</div>")

        del self.mock_array.variable._data._repr_html_
        with patch('xarray.core.formatting_html.short_data_repr', return_value='short_repr'):
            result = fh.short_data_repr_html(self.mock_array)
            self.assertEqual(result, "<pre>short_repr</pre>")

    def test_format_dims(self):
        dims = OrderedDict([('x', 10), ('y', 20)])
        coord_names = ['x']
        result = fh.format_dims(dims, coord_names)
        self.assertIn("class='xr-has-index'", result)
        self.assertIn("<li><span class='xr-has-index'>x</span>: 10</li>", result)

    def test_summarize_attrs(self):
        attrs = {'attr1': 'value1', 'attr2': 'value2'}
        result = fh.summarize_attrs(attrs)
        self.assertIn("<dt><span>attr1 :</span></dt><dd>value1</dd>", result)

    def test_icon(self):
        result = fh._icon("test-icon")
        self.assertIn("<svg class='icon xr-test-icon'>", result)

    def test_summarize_coord_multiindex(self):
        coord = MagicMock()
        coord.level_names = ['level1', 'level2']
        with patch('xarray.core.formatting_html.summarize_variable', return_value='summary'):
            result = fh._summarize_coord_multiindex('coord_name', coord)
            self.assertIn('summary', result)

    def test_summarize_coord(self):
        var = MagicMock()
        var.dims = ['x']
        var.variable.to_index_variable.return_value.level_names = ['level1']
        with patch('xarray.core.formatting_html.summarize_variable', return_value='summary'):
            result = fh.summarize_coord('x', var)
            self.assertIn('summary', result['x'])
            self.assertIn('summary', result['level1'])

    def test_summarize_coords(self):
        variables = {'x': self.mock_array, 'y': self.mock_array}
        with patch('xarray.core.formatting_html.summarize_coord', return_value={'x': 'summary'}):
            result = fh.summarize_coords(variables)
            self.assertIn("<li class='xr-var-item'>summary</li>", result)

    def test_summarize_variable(self):
        var = MagicMock()
        var.dims = ['x']
        var.dtype = 'float64'
        var.attrs = {'attr1': 'value1'}
        with patch('xarray.core.formatting_html.inline_variable_array_repr', return_value='preview'):
            with patch('xarray.core.formatting_html.short_data_repr_html', return_value='data_repr'):
                result = fh.summarize_variable('var_name', var)
                self.assertIn("<div class='xr-var-name'><span>var_name</span></div>", result)

    def test_summarize_vars(self):
        variables = {'var1': self.mock_array, 'var2': self.mock_array}
        with patch('xarray.core.formatting_html.summarize_variable', return_value='summary'):
            result = fh.summarize_vars(variables)
            self.assertIn("<li class='xr-var-item'>summary</li>", result)

    def test_collapsible_section(self):
        result = fh.collapsible_section('Section', n_items=5)
        self.assertIn("Section: <span>(5)</span>", result)

    def test_mapping_section(self):
        mapping = {'key1': 'value1', 'key2': 'value2'}
        with patch('xarray.core.formatting_html._get_boolean_with_default', return_value=True):
            with patch('xarray.core.formatting_html.summarize_attrs', return_value='details'):
                result = fh._mapping_section(mapping, 'Test', fh.summarize_attrs, 10, 'option_name')
                self.assertIn("Test: <span>(2)</span>", result)

    def test_dim_section(self):
        result = fh.dim_section(self.mock_dataset)
        self.assertIn("Dimensions", result)

    def test_array_section(self):
        with patch('xarray.core.formatting_html.inline_variable_array_repr', return_value='preview'):
            with patch('xarray.core.formatting_html.short_data_repr_html', return_value='data_repr'):
                result = fh.array_section(self.mock_array)
                self.assertIn("Show/hide data repr", result)

    def test_array_repr(self):
        self.mock_array.variable.size = 1
        with patch('xarray.core.formatting_html._obj_repr', return_value='obj_repr'):
            result = fh.array_repr(self.mock_array)
            self.assertEqual(result, 'obj_repr')

    def test_dataset_repr(self):
        self.mock_dataset.coords['x'].variable.size = 1
        with patch('xarray.core.formatting_html._obj_repr', return_value='obj_repr'):
            result = fh.dataset_repr(self.mock_dataset)
            self.assertEqual(result, 'obj_repr')
Coverage: 82.6086956521739
Mutation Score: 57.58
Output: On branch main
Changes not staged for commit:
  (use "git add/rm <file>..." to update what will be committed)
  (use "git restore <file>..." to discard changes in working directory)
        deleted:    .coveragerc
        modified:   xarray/tests/test_formatting_html.py

no changes added to commit (use "git add" and/or "git commit -a")
commit 4e77576adf1de2b1af34963543aa9c7c19dc5aa0
Author: TestGenEval <>
Date:   Wed Dec 11 12:38:22 2024 +0000

    Testing fixes

diff --git a/xarray/core/formatting.py b/xarray/core/formatting.py
index 13f38820..31a1b777 100644
--- a/xarray/core/formatting.py
+++ b/xarray/core/formatting.py
@@ -11,7 +11,7 @@ import pandas as pd
 from pandas.errors import OutOfBoundsDatetime

 from .duck_array_ops import array_equiv
-from .options import OPTIONS
+from .options import OPTIONS, _get_boolean_with_default
 from .pycompat import dask_array_type, sparse_array_type
 from .utils import is_duck_array

@@ -371,7 +371,9 @@ def _calculate_col_width(col_items):
     return col_width


-def _mapping_repr(mapping, title, summarizer, col_width=None, max_rows=None):
+def _mapping_repr(
+    mapping, title, summarizer, expand_option_name, col_width=None, max_rows=None
+):
     if col_width is None:
         col_width = _calculate_col_width(mapping)
     if max_rows is None:
@@ -379,7 +381,9 @@ def _mapping_repr(mapping, title, summarizer, col_width=None, max_rows=None):
     summary = [f"{title}:"]
     if mapping:
         len_mapping = len(mapping)
-        if len_mapping > max_rows:
+        if not _get_boolean_with_default(expand_option_name, default=True):
+            summary = [f"{summary[0]} ({len_mapping})"]
+        elif len_mapping > max_rows:
             summary = [f"{summary[0]} ({max_rows}/{len_mapping})"]
             first_rows = max_rows // 2 + max_rows % 2
             items = list(mapping.items())
@@ -396,12 +400,18 @@ def _mapping_repr(mapping, title, summarizer, col_width=None, max_rows=None):


 data_vars_repr = functools.partial(
-    _mapping_repr, title="Data variables", summarizer=summarize_datavar
+    _mapping_repr,
+    title="Data variables",
+    summarizer=summarize_datavar,
+    expand_option_name="display_expand_data_vars",
 )


 attrs_repr = functools.partial(
-    _mapping_repr, title="Attributes", summarizer=summarize_attr
+    _mapping_repr,
+    title="Attributes",
+    summarizer=summarize_attr,
+    expand_option_name="display_expand_attrs",
 )


@@ -409,7 +419,11 @@ def coords_repr(coords, col_width=None):
     if col_width is None:
         col_width = _calculate_col_width(_get_col_items(coords))
     return _mapping_repr(
-        coords, title="Coordinates", summarizer=summarize_coord, col_width=col_width
+        coords,
+        title="Coordinates",
+        summarizer=summarize_coord,
+        expand_option_name="display_expand_coords",
+        col_width=col_width,
     )


@@ -493,9 +507,14 @@ def array_repr(arr):
     else:
         name_str = ""

+    if _get_boolean_with_default("display_expand_data", default=True):
+        data_repr = short_data_repr(arr)
+    else:
+        data_repr = inline_variable_array_repr(arr, OPTIONS["display_width"])
+
     summary = [
         "<xarray.{} {}({})>".format(type(arr).__name__, name_str, dim_summary(arr)),
-        short_data_repr(arr),
+        data_repr,
     ]

     if hasattr(arr, "coords"):
diff --git a/xarray/core/formatting_html.py b/xarray/core/formatting_html.py
index 3392aef8..9730a0a1 100644
--- a/xarray/core/formatting_html.py
+++ b/xarray/core/formatting_html.py
@@ -6,6 +6,7 @@ from html import escape
 import pkg_resources

 from .formatting import inline_variable_array_repr, short_data_repr
+from .options import _get_boolean_with_default

 STATIC_FILES = ("static/html/icons-svg-inline.html", "static/css/style.css")

@@ -164,9 +165,14 @@ def collapsible_section(
     )


-def _mapping_section(mapping, name, details_func, max_items_collapse, enabled=True):
+def _mapping_section(
+    mapping, name, details_func, max_items_collapse, expand_option_name, enabled=True
+):
     n_items = len(mapping)
-    collapsed = n_items >= max_items_collapse
+    expanded = _get_boolean_with_default(
+        expand_option_name, n_items < max_items_collapse
+    )
+    collapsed = not expanded

     return collapsible_section(
         name,
@@ -188,7 +194,11 @@ def dim_section(obj):
 def array_section(obj):
     # "unique" id to expand/collapse the section
     data_id = "section-" + str(uuid.uuid4())
-    collapsed = "checked"
+    collapsed = (
+        "checked"
+        if _get_boolean_with_default("display_expand_data", default=True)
+        else ""
+    )
     variable = getattr(obj, "variable", obj)
     preview = escape(inline_variable_array_repr(variable, max_width=70))
     data_repr = short_data_repr_html(obj)
@@ -209,6 +219,7 @@ coord_section = partial(
     name="Coordinates",
     details_func=summarize_coords,
     max_items_collapse=25,
+    expand_option_name="display_expand_coords",
 )


@@ -217,6 +228,7 @@ datavar_section = partial(
     name="Data variables",
     details_func=summarize_vars,
     max_items_collapse=15,
+    expand_option_name="display_expand_data_vars",
 )


@@ -225,6 +237,7 @@ attr_section = partial(
     name="Attributes",
     details_func=summarize_attrs,
     max_items_collapse=10,
+    expand_option_name="display_expand_attrs",
 )


diff --git a/xarray/core/options.py b/xarray/core/options.py
index 12969890..d53c9d5d 100644
--- a/xarray/core/options.py
+++ b/xarray/core/options.py
@@ -6,6 +6,10 @@ CMAP_SEQUENTIAL = "cmap_sequential"
 DISPLAY_MAX_ROWS = "display_max_rows"
 DISPLAY_STYLE = "display_style"
 DISPLAY_WIDTH = "display_width"
+DISPLAY_EXPAND_ATTRS = "display_expand_attrs"
+DISPLAY_EXPAND_COORDS = "display_expand_coords"
+DISPLAY_EXPAND_DATA_VARS = "display_expand_data_vars"
+DISPLAY_EXPAND_DATA = "display_expand_data"
 ENABLE_CFTIMEINDEX = "enable_cftimeindex"
 FILE_CACHE_MAXSIZE = "file_cache_maxsize"
 KEEP_ATTRS = "keep_attrs"
@@ -19,6 +23,10 @@ OPTIONS = {
     DISPLAY_MAX_ROWS: 12,
     DISPLAY_STYLE: "html",
     DISPLAY_WIDTH: 80,
+    DISPLAY_EXPAND_ATTRS: "default",
+    DISPLAY_EXPAND_COORDS: "default",
+    DISPLAY_EXPAND_DATA_VARS: "default",
+    DISPLAY_EXPAND_DATA: "default",
     ENABLE_CFTIMEINDEX: True,
     FILE_CACHE_MAXSIZE: 128,
     KEEP_ATTRS: "default",
@@ -38,6 +46,10 @@ _VALIDATORS = {
     DISPLAY_MAX_ROWS: _positive_integer,
     DISPLAY_STYLE: _DISPLAY_OPTIONS.__contains__,
     DISPLAY_WIDTH: _positive_integer,
+    DISPLAY_EXPAND_ATTRS: lambda choice: choice in [True, False, "default"],
+    DISPLAY_EXPAND_COORDS: lambda choice: choice in [True, False, "default"],
+    DISPLAY_EXPAND_DATA_VARS: lambda choice: choice in [True, False, "default"],
+    DISPLAY_EXPAND_DATA: lambda choice: choice in [True, False, "default"],
     ENABLE_CFTIMEINDEX: lambda value: isinstance(value, bool),
     FILE_CACHE_MAXSIZE: _positive_integer,
     KEEP_ATTRS: lambda choice: choice in [True, False, "default"],
@@ -65,8 +77,8 @@ _SETTERS = {
 }


-def _get_keep_attrs(default):
-    global_choice = OPTIONS["keep_attrs"]
+def _get_boolean_with_default(option, default):
+    global_choice = OPTIONS[option]

     if global_choice == "default":
         return default
@@ -74,10 +86,14 @@ def _get_keep_attrs(default):
         return global_choice
     else:
         raise ValueError(
-            "The global option keep_attrs must be one of True, False or 'default'."
+            f"The global option {option} must be one of True, False or 'default'."
         )


+def _get_keep_attrs(default):
+    return _get_boolean_with_default("keep_attrs", default)
+
+
 class set_options:
     """Set options for xarray in a controlled context.

@@ -108,6 +124,22 @@ class set_options:
       Default: ``'default'``.
     - ``display_style``: display style to use in jupyter for xarray objects.
       Default: ``'text'``. Other options are ``'html'``.
+    - ``display_expand_attrs``: whether to expand the attributes section for
+      display of ``DataArray`` or ``Dataset`` objects. Can be ``True`` to always
+      expand, ``False`` to always collapse, or ``default`` to expand unless over
+      a pre-defined limit. Default: ``default``.
+    - ``display_expand_coords``: whether to expand the coordinates section for
+      display of ``DataArray`` or ``Dataset`` objects. Can be ``True`` to always
+      expand, ``False`` to always collapse, or ``default`` to expand unless over
+      a pre-defined limit. Default: ``default``.
+    - ``display_expand_data``: whether to expand the data section for display
+      of ``DataArray`` objects. Can be ``True`` to always expand, ``False`` to
+      always collapse, or ``default`` to expand unless over a pre-defined limit.
+      Default: ``default``.
+    - ``display_expand_data_vars``: whether to expand the data variables section
+      for display of ``Dataset`` objects. Can be ``True`` to always
+      expand, ``False`` to always collapse, or ``default`` to expand unless over
+      a pre-defined limit. Default: ``default``.


     You can use ``set_options`` either as a context manager:
diff --git a/xarray/tests/test_formatting.py b/xarray/tests/test_formatting.py
deleted file mode 100644
index 1098587d..00000000
--- a/xarray/tests/test_formatting.py
+++ /dev/null
@@ -1,494 +0,0 @@
-import sys
-from textwrap import dedent
-
-import numpy as np
-import pandas as pd
-import pytest
-
-import xarray as xr
-from xarray.core import formatting
-
-
-class TestFormatting:
-    def test_get_indexer_at_least_n_items(self):
-        cases = [
-            ((20,), (slice(10),), (slice(-10, None),)),
-            ((3, 20), (0, slice(10)), (-1, slice(-10, None))),
-            ((2, 10), (0, slice(10)), (-1, slice(-10, None))),
-            ((2, 5), (slice(2), slice(None)), (slice(-2, None), slice(None))),
-            ((1, 2, 5), (0, slice(2), slice(None)), (-1, slice(-2, None), slice(None))),
-            ((2, 3, 5), (0, slice(2), slice(None)), (-1, slice(-2, None), slice(None))),
-            (
-                (1, 10, 1),
-                (0, slice(10), slice(None)),
-                (-1, slice(-10, None), slice(None)),
-            ),
-            (
-                (2, 5, 1),
-                (slice(2), slice(None), slice(None)),
-                (slice(-2, None), slice(None), slice(None)),
-            ),
-            ((2, 5, 3), (0, slice(4), slice(None)), (-1, slice(-4, None), slice(None))),
-            (
-                (2, 3, 3),
-                (slice(2), slice(None), slice(None)),
-                (slice(-2, None), slice(None), slice(None)),
-            ),
-        ]
-        for shape, start_expected, end_expected in cases:
-            actual = formatting._get_indexer_at_least_n_items(shape, 10, from_end=False)
-            assert start_expected == actual
-            actual = formatting._get_indexer_at_least_n_items(shape, 10, from_end=True)
-            assert end_expected == actual
-
-    def test_first_n_items(self):
-        array = np.arange(100).reshape(10, 5, 2)
-        for n in [3, 10, 13, 100, 200]:
-            actual = formatting.first_n_items(array, n)
-            expected = array.flat[:n]
-            assert (expected == actual).all()
-
-        with pytest.raises(ValueError, match=r"at least one item"):
-            formatting.first_n_items(array, 0)
-
-    def test_last_n_items(self):
-        array = np.arange(100).reshape(10, 5, 2)
-        for n in [3, 10, 13, 100, 200]:
-            actual = formatting.last_n_items(array, n)
-            expected = array.flat[-n:]
-            assert (expected == actual).all()
-
-        with pytest.raises(ValueError, match=r"at least one item"):
-            formatting.first_n_items(array, 0)
-
-    def test_last_item(self):
-        array = np.arange(100)
-
-        reshape = ((10, 10), (1, 100), (2, 2, 5, 5))
-        expected = np.array([99])
-
-        for r in reshape:
-            result = formatting.last_item(array.reshape(r))
-            assert result == expected
-
-    def test_format_item(self):
-        cases = [
-            (pd.Timestamp("2000-01-01T12"), "2000-01-01T12:00:00"),
-            (pd.Timestamp("2000-01-01"), "2000-01-01"),
-            (pd.Timestamp("NaT"), "NaT"),
-            (pd.Timedelta("10 days 1 hour"), "10 days 01:00:00"),
-            (pd.Timedelta("-3 days"), "-3 days +00:00:00"),
-            (pd.Timedelta("3 hours"), "0 days 03:00:00"),
-            (pd.Timedelta("NaT"), "NaT"),
-            ("foo", "'foo'"),
-            (b"foo", "b'foo'"),
-            (1, "1"),
-            (1.0, "1.0"),
-            (np.float16(1.1234), "1.123"),
-            (np.float32(1.0111111), "1.011"),
-            (np.float64(22.222222), "22.22"),
-        ]
-        for item, expected in cases:
-            actual = formatting.format_item(item)
-            assert expected == actual
-
-    def test_format_items(self):
-        cases = [
-            (np.arange(4) * np.timedelta64(1, "D"), "0 days 1 days 2 days 3 days"),
-            (
-                np.arange(4) * np.timedelta64(3, "h"),
-                "00:00:00 03:00:00 06:00:00 09:00:00",
-            ),
-            (
-                np.arange(4) * np.timedelta64(500, "ms"),
-                "00:00:00 00:00:00.500000 00:00:01 00:00:01.500000",
-            ),
-            (pd.to_timedelta(["NaT", "0s", "1s", "NaT"]), "NaT 00:00:00 00:00:01 NaT"),
-            (
-                pd.to_timedelta(["1 day 1 hour", "1 day", "0 hours"]),
-                "1 days 01:00:00 1 days 00:00:00 0 days 00:00:00",
-            ),
-            ([1, 2, 3], "1 2 3"),
-        ]
-        for item, expected in cases:
-            actual = " ".join(formatting.format_items(item))
-            assert expected == actual
-
-    def test_format_array_flat(self):
-        actual = formatting.format_array_flat(np.arange(100), 2)
-        expected = "..."
-        assert expected == actual
-
-        actual = formatting.format_array_flat(np.arange(100), 9)
-        expected = "0 ... 99"
-        assert expected == actual
-
-        actual = formatting.format_array_flat(np.arange(100), 10)
-        expected = "0 1 ... 99"
-        assert expected == actual
-
-        actual = formatting.format_array_flat(np.arange(100), 13)
-        expected = "0 1 ... 98 99"
-        assert expected == actual
-
-        actual = formatting.format_array_flat(np.arange(100), 15)
-        expected = "0 1 2 ... 98 99"
-        assert expected == actual
-
-        # NB: Probably not ideal; an alternative would be cutting after the
-        # first ellipsis
-        actual = formatting.format_array_flat(np.arange(100.0), 11)
-        expected = "0.0 ... ..."
-        assert expected == actual
-
-        actual = formatting.format_array_flat(np.arange(100.0), 12)
-        expected = "0.0 ... 99.0"
-        assert expected == actual
-
-        actual = formatting.format_array_flat(np.arange(3), 5)
-        expected = "0 1 2"
-        assert expected == actual
-
-        actual = formatting.format_array_flat(np.arange(4.0), 11)
-        expected = "0.0 ... 3.0"
-        assert expected == actual
-
-        actual = formatting.format_array_flat(np.arange(0), 0)
-        expected = ""
-        assert expected == actual
-
-        actual = formatting.format_array_flat(np.arange(1), 1)
-        expected = "0"
-        assert expected == actual
-
-        actual = formatting.format_array_flat(np.arange(2), 3)
-        expected = "0 1"
-        assert expected == actual
-
-        actual = formatting.format_array_flat(np.arange(4), 7)
-        expected = "0 1 2 3"
-        assert expected == actual
-
-        actual = formatting.format_array_flat(np.arange(5), 7)
-        expected = "0 ... 4"
-        assert expected == actual
-
-        long_str = [" ".join(["hello world" for _ in range(100)])]
-        actual = formatting.format_array_flat(np.asarray([long_str]), 21)
-        expected = "'hello world hello..."
-        assert expected == actual
-
-    def test_pretty_print(self):
-        assert formatting.pretty_print("abcdefghij", 8) == "abcde..."
-        assert formatting.pretty_print("ß", 1) == "ß"
-
-    def test_maybe_truncate(self):
-        assert formatting.maybe_truncate("ß", 10) == "ß"
-
-    def test_format_timestamp_out_of_bounds(self):
-        from datetime import datetime
-
-        date = datetime(1300, 12, 1)
-        expected = "1300-12-01"
-        result = formatting.format_timestamp(date)
-        assert result == expected
-
-        date = datetime(2300, 12, 1)
-        expected = "2300-12-01"
-        result = formatting.format_timestamp(date)
-        assert result == expected
-
-    def test_attribute_repr(self):
-        short = formatting.summarize_attr("key", "Short string")
-        long = formatting.summarize_attr("key", 100 * "Very long string ")
-        newlines = formatting.summarize_attr("key", "\n\n\n")
-        tabs = formatting.summarize_attr("key", "\t\t\t")
-        assert short == "    key: Short string"
-        assert len(long) <= 80
-        assert long.endswith("...")
-        assert "\n" not in newlines
-        assert "\t" not in tabs
-
-    def test_diff_array_repr(self):
-        da_a = xr.DataArray(
-            np.array([[1, 2, 3], [4, 5, 6]], dtype="int64"),
-            dims=("x", "y"),
-            coords={
-                "x": np.array(["a", "b"], dtype="U1"),
-                "y": np.array([1, 2, 3], dtype="int64"),
-            },
-            attrs={"units": "m", "description": "desc"},
-        )
-
-        da_b = xr.DataArray(
-            np.array([1, 2], dtype="int64"),
-            dims="x",
-            coords={
-                "x": np.array(["a", "c"], dtype="U1"),
-                "label": ("x", np.array([1, 2], dtype="int64")),
-            },
-            attrs={"units": "kg"},
-        )
-
-        byteorder = "<" if sys.byteorder == "little" else ">"
-        expected = dedent(
-            """\
-        Left and right DataArray objects are not identical
-        Differing dimensions:
-            (x: 2, y: 3) != (x: 2)
-        Differing values:
-        L
-            array([[1, 2, 3],
-                   [4, 5, 6]], dtype=int64)
-        R
-            array([1, 2], dtype=int64)
-        Differing coordinates:
-        L * x        (x) %cU1 'a' 'b'
-        R * x        (x) %cU1 'a' 'c'
-        Coordinates only on the left object:
-          * y        (y) int64 1 2 3
-        Coordinates only on the right object:
-            label    (x) int64 1 2
-        Differing attributes:
-        L   units: m
-        R   units: kg
-        Attributes only on the left object:
-            description: desc"""
-            % (byteorder, byteorder)
-        )
-
-        actual = formatting.diff_array_repr(da_a, da_b, "identical")
-        try:
-            assert actual == expected
-        except AssertionError:
-            # depending on platform, dtype may not be shown in numpy array repr
-            assert actual == expected.replace(", dtype=int64", "")
-
-        va = xr.Variable(
-            "x", np.array([1, 2, 3], dtype="int64"), {"title": "test Variable"}
-        )
-        vb = xr.Variable(("x", "y"), np.array([[1, 2, 3], [4, 5, 6]], dtype="int64"))
-
-        expected = dedent(
-            """\
-        Left and right Variable objects are not equal
-        Differing dimensions:
-            (x: 3) != (x: 2, y: 3)
-        Differing values:
-        L
-            array([1, 2, 3], dtype=int64)
-        R
-            array([[1, 2, 3],
-                   [4, 5, 6]], dtype=int64)"""
-        )
-
-        actual = formatting.diff_array_repr(va, vb, "equals")
-        try:
-            assert actual == expected
-        except AssertionError:
-            assert actual == expected.replace(", dtype=int64", "")
-
-    @pytest.mark.filterwarnings("error")
-    def test_diff_attrs_repr_with_array(self):
-        attrs_a = {"attr": np.array([0, 1])}
-
-        attrs_b = {"attr": 1}
-        expected = dedent(
-            """\
-            Differing attributes:
-            L   attr: [0 1]
-            R   attr: 1
-            """
-        ).strip()
-        actual = formatting.diff_attrs_repr(attrs_a, attrs_b, "equals")
-        assert expected == actual
-
-        attrs_b = {"attr": np.array([-3, 5])}
-        expected = dedent(
-            """\
-            Differing attributes:
-            L   attr: [0 1]
-            R   attr: [-3  5]
-            """
-        ).strip()
-        actual = formatting.diff_attrs_repr(attrs_a, attrs_b, "equals")
-        assert expected == actual
-
-        # should not raise a warning
-        attrs_b = {"attr": np.array([0, 1, 2])}
-        expected = dedent(
-            """\
-            Differing attributes:
-            L   attr: [0 1]
-            R   attr: [0 1 2]
-            """
-        ).strip()
-        actual = formatting.diff_attrs_repr(attrs_a, attrs_b, "equals")
-        assert expected == actual
-
-    def test_diff_dataset_repr(self):
-        ds_a = xr.Dataset(
-            data_vars={
-                "var1": (("x", "y"), np.array([[1, 2, 3], [4, 5, 6]], dtype="int64")),
-                "var2": ("x", np.array([3, 4], dtype="int64")),
-            },
-            coords={
-                "x": np.array(["a", "b"], dtype="U1"),
-                "y": np.array([1, 2, 3], dtype="int64"),
-            },
-            attrs={"units": "m", "description": "desc"},
-        )
-
-        ds_b = xr.Dataset(
-            data_vars={"var1": ("x", np.array([1, 2], dtype="int64"))},
-            coords={
-                "x": ("x", np.array(["a", "c"], dtype="U1"), {"source": 0}),
-                "label": ("x", np.array([1, 2], dtype="int64")),
-            },
-            attrs={"units": "kg"},
-        )
-
-        byteorder = "<" if sys.byteorder == "little" else ">"
-        expected = dedent(
-            """\
-        Left and right Dataset objects are not identical
-        Differing dimensions:
-            (x: 2, y: 3) != (x: 2)
-        Differing coordinates:
-        L * x        (x) %cU1 'a' 'b'
-        R * x        (x) %cU1 'a' 'c'
-            source: 0
-        Coordinates only on the left object:
-          * y        (y) int64 1 2 3
-        Coordinates only on the right object:
-            label    (x) int64 1 2
-        Differing data variables:
-        L   var1     (x, y) int64 1 2 3 4 5 6
-        R   var1     (x) int64 1 2
-        Data variables only on the left object:
-            var2     (x) int64 3 4
-        Differing attributes:
-        L   units: m
-        R   units: kg
-        Attributes only on the left object:
-            description: desc"""
-            % (byteorder, byteorder)
-        )
-
-        actual = formatting.diff_dataset_repr(ds_a, ds_b, "identical")
-        assert actual == expected
-
-    def test_array_repr(self):
-        ds = xr.Dataset(coords={"foo": [1, 2, 3], "bar": [1, 2, 3]})
-        ds[(1, 2)] = xr.DataArray([0], dims="test")
-        actual = formatting.array_repr(ds[(1, 2)])
-        expected = dedent(
-            """\
-        <xarray.DataArray (1, 2) (test: 1)>
-        array([0])
-        Dimensions without coordinates: test"""
-        )
-
-        assert actual == expected
-
-
-def test_inline_variable_array_repr_custom_repr():
-    class CustomArray:
-        def __init__(self, value, attr):
-            self.value = value
-            self.attr = attr
-
-        def _repr_inline_(self, width):
-            formatted = f"({self.attr}) {self.value}"
-            if len(formatted) > width:
-                formatted = f"({self.attr}) ..."
-
-            return formatted
-
-        def __array_function__(self, *args, **kwargs):
-            return NotImplemented
-
-        @property
-        def shape(self):
-            return self.value.shape
-
-        @property
-        def dtype(self):
-            return self.value.dtype
-
-        @property
-        def ndim(self):
-            return self.value.ndim
-
-    value = CustomArray(np.array([20, 40]), "m")
-    variable = xr.Variable("x", value)
-
-    max_width = 10
-    actual = formatting.inline_variable_array_repr(variable, max_width=10)
-
-    assert actual == value._repr_inline_(max_width)
-
-
-def test_set_numpy_options():
-    original_options = np.get_printoptions()
-    with formatting.set_numpy_options(threshold=10):
-        assert len(repr(np.arange(500))) < 200
-    # original options are restored
-    assert np.get_printoptions() == original_options
-
-
-def test_short_numpy_repr():
-    cases = [
-        np.random.randn(500),
-        np.random.randn(20, 20),
-        np.random.randn(5, 10, 15),
-        np.random.randn(5, 10, 15, 3),
-        np.random.randn(100, 5, 1),
-    ]
-    # number of lines:
-    # for default numpy repr: 167, 140, 254, 248, 599
-    # for short_numpy_repr: 1, 7, 24, 19, 25
-    for array in cases:
-        num_lines = formatting.short_numpy_repr(array).count("\n") + 1
-        assert num_lines < 30
-
-
-def test_large_array_repr_length():
-
-    da = xr.DataArray(np.random.randn(100, 5, 1))
-
-    result = repr(da).splitlines()
-    assert len(result) < 50
-
-
-@pytest.mark.parametrize(
-    "display_max_rows, n_vars, n_attr",
-    [(50, 40, 30), (35, 40, 30), (11, 40, 30), (1, 40, 30)],
-)
-def test__mapping_repr(display_max_rows, n_vars, n_attr):
-    long_name = "long_name"
-    a = np.core.defchararray.add(long_name, np.arange(0, n_vars).astype(str))
-    b = np.core.defchararray.add("attr_", np.arange(0, n_attr).astype(str))
-    attrs = {k: 2 for k in b}
-    coords = dict(time=np.array([0, 1]))
-    data_vars = dict()
-    for v in a:
-        data_vars[v] = xr.DataArray(
-            name=v,
-            data=np.array([3, 4]),
-            dims=["time"],
-            coords=coords,
-        )
-    ds = xr.Dataset(data_vars)
-    ds.attrs = attrs
-
-    with xr.set_options(display_max_rows=display_max_rows):
-
-        # Parse the data_vars print and show only data_vars rows:
-        summary = formatting.data_vars_repr(ds.data_vars).split("\n")
-        summary = [v for v in summary if long_name in v]
-
-        # The length should be less than or equal to display_max_rows:
-        len_summary = len(summary)
-        data_vars_print_size = min(display_max_rows, len_summary)
-        assert len_summary == data_vars_print_size
diff --git a/xarray/tests/test_formatting_html.py b/xarray/tests/test_formatting_html.py
index 9a210ad6..4cf4509c 100644
--- a/xarray/tests/test_formatting_html.py
+++ b/xarray/tests/test_formatting_html.py
@@ -115,6 +115,17 @@ def test_repr_of_dataarray(dataarray):
         formatted.count("class='xr-section-summary-in' type='checkbox' disabled >") == 2
     )

+    with xr.set_options(display_expand_data=False):
+        formatted = fh.array_repr(dataarray)
+        assert "dim_0" in formatted
+        # has an expanded data section
+        assert formatted.count("class='xr-array-in' type='checkbox' checked>") == 0
+        # coords and attrs don't have an items so they'll be be disabled and collapsed
+        assert (
+            formatted.count("class='xr-section-summary-in' type='checkbox' disabled >")
+            == 2
+        )
+

 def test_summary_of_multiindex_coord(multiindex):
     idx = multiindex.x.variable.to_index_variable()
@@ -138,6 +149,20 @@ def test_repr_of_dataset(dataset):
     assert "&lt;U4" in formatted or "&gt;U4" in formatted
     assert "&lt;IA&gt;" in formatted

+    with xr.set_options(
+        display_expand_coords=False,
+        display_expand_data_vars=False,
+        display_expand_attrs=False,
+    ):
+        formatted = fh.dataset_repr(dataset)
+        # coords, attrs, and data_vars are collapsed
+        assert (
+            formatted.count("class='xr-section-summary-in' type='checkbox'  checked>")
+            == 0
+        )
+        assert "&lt;U4" in formatted or "&gt;U4" in formatted
+        assert "&lt;IA&gt;" in formatted
+

 def test_repr_text_fallback(dataset):
     formatted = fh.dataset_repr(dataset)
Obtaining file:///testbed
  Installing build dependencies: started
  Installing build dependencies: finished with status 'done'
  Checking if build backend supports build_editable: started
  Checking if build backend supports build_editable: finished with status 'done'
  Getting requirements to build editable: started
  Getting requirements to build editable: finished with status 'done'
  Preparing editable metadata (pyproject.toml): started
  Preparing editable metadata (pyproject.toml): finished with status 'done'
Requirement already satisfied: numpy>=1.17 in /opt/miniconda3/envs/testbed/lib/python3.10/site-packages (from xarray==0.17.1.dev81+g4e77576a.d20250207) (1.23.0)
Requirement already satisfied: pandas>=1.0 in /opt/miniconda3/envs/testbed/lib/python3.10/site-packages (from xarray==0.17.1.dev81+g4e77576a.d20250207) (1.5.3)
Requirement already satisfied: setuptools>=40.4 in /opt/miniconda3/envs/testbed/lib/python3.10/site-packages (from xarray==0.17.1.dev81+g4e77576a.d20250207) (68.0.0)
Requirement already satisfied: python-dateutil>=2.8.1 in /opt/miniconda3/envs/testbed/lib/python3.10/site-packages (from pandas>=1.0->xarray==0.17.1.dev81+g4e77576a.d20250207) (2.8.2)
Requirement already satisfied: pytz>=2020.1 in /opt/miniconda3/envs/testbed/lib/python3.10/site-packages (from pandas>=1.0->xarray==0.17.1.dev81+g4e77576a.d20250207) (2023.3)
Requirement already satisfied: six>=1.5 in /opt/miniconda3/envs/testbed/lib/python3.10/site-packages (from python-dateutil>=2.8.1->pandas>=1.0->xarray==0.17.1.dev81+g4e77576a.d20250207) (1.16.0)
Building wheels for collected packages: xarray
  Building editable for xarray (pyproject.toml): started
  Building editable for xarray (pyproject.toml): finished with status 'done'
  Created wheel for xarray: filename=xarray-0.17.1.dev81+g4e77576a.d20250207-0.editable-py3-none-any.whl size=9077 sha256=ec93a55442fe558a71f546b1b2cd82c728391a56ec1f60640c164d786235685d
  Stored in directory: /tmp/pip-ephem-wheel-cache-zhm4uatd/wheels/0d/a6/cb/465a7b303d624cc531250fa27c75d038ddc29430bdb6ba7c9f
Successfully built xarray
Installing collected packages: xarray
  Attempting uninstall: xarray
    Found existing installation: xarray 0.17.1.dev81+g4e77576a.d20250207
    Uninstalling xarray-0.17.1.dev81+g4e77576a.d20250207:
      Successfully uninstalled xarray-0.17.1.dev81+g4e77576a.d20250207
Successfully installed xarray-0.17.1.dev81+g4e77576a.d20250207
WARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager, possibly rendering your system unusable.It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv. Use the --root-user-action option if you know what you are doing and want to suppress this warning.
============================= test session starts ==============================
platform linux -- Python 3.10.14, pytest-7.4.0, pluggy-1.5.0
rootdir: /testbed
configfile: setup.cfg
plugins: env-1.1.3, cov-5.0.0, hypothesis-6.108.5, xdist-3.6.1
collected 14 items

xarray/tests/test_formatting_html.py ..............                      [100%]

=============================== warnings summary ===============================
xarray/__init__.py:1
  /testbed/xarray/__init__.py:1: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html
    import pkg_resources

../opt/miniconda3/envs/testbed/lib/python3.10/site-packages/pkg_resources/__init__.py:2871
  /opt/miniconda3/envs/testbed/lib/python3.10/site-packages/pkg_resources/__init__.py:2871: DeprecationWarning: Deprecated call to `pkg_resources.declare_namespace('pydap')`.
  Implementing implicit namespace packages (as specified in PEP 420) is preferred to `pkg_resources.declare_namespace`. See https://setuptools.pypa.io/en/latest/references/keywords.html#keyword-namespace-packages
    declare_namespace(pkg)

../opt/miniconda3/envs/testbed/lib/python3.10/site-packages/pkg_resources/__init__.py:2871
  /opt/miniconda3/envs/testbed/lib/python3.10/site-packages/pkg_resources/__init__.py:2871: DeprecationWarning: Deprecated call to `pkg_resources.declare_namespace('pydap.responses')`.
  Implementing implicit namespace packages (as specified in PEP 420) is preferred to `pkg_resources.declare_namespace`. See https://setuptools.pypa.io/en/latest/references/keywords.html#keyword-namespace-packages
    declare_namespace(pkg)

../opt/miniconda3/envs/testbed/lib/python3.10/site-packages/pkg_resources/__init__.py:2350
../opt/miniconda3/envs/testbed/lib/python3.10/site-packages/pkg_resources/__init__.py:2350
../opt/miniconda3/envs/testbed/lib/python3.10/site-packages/pkg_resources/__init__.py:2350
  /opt/miniconda3/envs/testbed/lib/python3.10/site-packages/pkg_resources/__init__.py:2350: DeprecationWarning: Deprecated call to `pkg_resources.declare_namespace('pydap')`.
  Implementing implicit namespace packages (as specified in PEP 420) is preferred to `pkg_resources.declare_namespace`. See https://setuptools.pypa.io/en/latest/references/keywords.html#keyword-namespace-packages
    declare_namespace(parent)

../opt/miniconda3/envs/testbed/lib/python3.10/site-packages/pkg_resources/__init__.py:2871
  /opt/miniconda3/envs/testbed/lib/python3.10/site-packages/pkg_resources/__init__.py:2871: DeprecationWarning: Deprecated call to `pkg_resources.declare_namespace('pydap.handlers')`.
  Implementing implicit namespace packages (as specified in PEP 420) is preferred to `pkg_resources.declare_namespace`. See https://setuptools.pypa.io/en/latest/references/keywords.html#keyword-namespace-packages
    declare_namespace(pkg)

../opt/miniconda3/envs/testbed/lib/python3.10/site-packages/pkg_resources/__init__.py:2871
  /opt/miniconda3/envs/testbed/lib/python3.10/site-packages/pkg_resources/__init__.py:2871: DeprecationWarning: Deprecated call to `pkg_resources.declare_namespace('pydap.tests')`.
  Implementing implicit namespace packages (as specified in PEP 420) is preferred to `pkg_resources.declare_namespace`. See https://setuptools.pypa.io/en/latest/references/keywords.html#keyword-namespace-packages
    declare_namespace(pkg)

xarray/core/dask_array_compat.py:61
xarray/core/dask_array_compat.py:61
  /testbed/xarray/core/dask_array_compat.py:61: DeprecationWarning: distutils Version classes are deprecated. Use packaging.version instead.
    if LooseVersion(dask_version) > LooseVersion("2.9.0"):

xarray/core/dask_array_compat.py:98
xarray/core/dask_array_compat.py:98
  /testbed/xarray/core/dask_array_compat.py:98: DeprecationWarning: distutils Version classes are deprecated. Use packaging.version instead.
    if LooseVersion(dask_version) > LooseVersion("2.30.0"):

xarray/core/dask_array_compat.py:155
xarray/core/dask_array_compat.py:155
  /testbed/xarray/core/dask_array_compat.py:155: DeprecationWarning: distutils Version classes are deprecated. Use packaging.version instead.
    if LooseVersion(dask_version) > LooseVersion("2021.03.0"):

xarray/core/npcompat.py:132
  /testbed/xarray/core/npcompat.py:132: DeprecationWarning: distutils Version classes are deprecated. Use packaging.version instead.
    if LooseVersion(np.__version__) >= "1.20.0":

../opt/miniconda3/envs/testbed/lib/python3.10/site-packages/setuptools/_distutils/version.py:345
../opt/miniconda3/envs/testbed/lib/python3.10/site-packages/setuptools/_distutils/version.py:345
  /opt/miniconda3/envs/testbed/lib/python3.10/site-packages/setuptools/_distutils/version.py:345: DeprecationWarning: distutils Version classes are deprecated. Use packaging.version instead.
    other = LooseVersion(other)

xarray/core/pdcompat.py:45
  /testbed/xarray/core/pdcompat.py:45: DeprecationWarning: distutils Version classes are deprecated. Use packaging.version instead.
    if LooseVersion(pd.__version__) < "0.25.0":

xarray/tests/__init__.py:58
xarray/tests/__init__.py:58
xarray/tests/__init__.py:58
xarray/tests/__init__.py:58
xarray/tests/__init__.py:58
xarray/tests/__init__.py:58
  /testbed/xarray/tests/__init__.py:58: DeprecationWarning: distutils Version classes are deprecated. Use packaging.version instead.
    return version.LooseVersion(vstring)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
==================================== PASSES ====================================
=========================== short test summary info ============================
PASSED xarray/tests/test_formatting_html.py::TestFormattingHTML::test_array_section
PASSED xarray/tests/test_formatting_html.py::TestFormattingHTML::test_collapsible_section
PASSED xarray/tests/test_formatting_html.py::TestFormattingHTML::test_dim_section
PASSED xarray/tests/test_formatting_html.py::TestFormattingHTML::test_format_dims
PASSED xarray/tests/test_formatting_html.py::TestFormattingHTML::test_icon
PASSED xarray/tests/test_formatting_html.py::TestFormattingHTML::test_load_static_files
PASSED xarray/tests/test_formatting_html.py::TestFormattingHTML::test_mapping_section
PASSED xarray/tests/test_formatting_html.py::TestFormattingHTML::test_short_data_repr_html
PASSED xarray/tests/test_formatting_html.py::TestFormattingHTML::test_summarize_attrs
PASSED xarray/tests/test_formatting_html.py::TestFormattingHTML::test_summarize_coord
PASSED xarray/tests/test_formatting_html.py::TestFormattingHTML::test_summarize_coord_multiindex
PASSED xarray/tests/test_formatting_html.py::TestFormattingHTML::test_summarize_coords
PASSED xarray/tests/test_formatting_html.py::TestFormattingHTML::test_summarize_variable
PASSED xarray/tests/test_formatting_html.py::TestFormattingHTML::test_summarize_vars
======================= 14 passed, 24 warnings in 3.44s ========================

